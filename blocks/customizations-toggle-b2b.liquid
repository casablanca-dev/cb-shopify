
{%- liquid
  assign block_settings = block.settings
  assign product_form_id = 'BuyButtons-ProductForm-' | append: section.id
-%}

<script
  src="{{ 'accordion-custom.js' | asset_url }}"
  type="module"
  fetchpriority="low"
></script>

<div
  class="customizations-toggle-b2b spacing-style"
  style="{% render 'spacing-style', settings: block_settings %}"
  {{ block.shopify_attributes }}
>
  <div class="customizations-toggle-b2b__header">
    <label class="customizations-toggle-b2b__toggle-wrapper">
      <span class="customizations-toggle-b2b__title">{{ block_settings.heading | default: 'Customizations' }}</span>
      <input
        type="checkbox"
        class="customizations-toggle-b2b__toggle"
        id="customizations-toggle-{{ section.id }}"
        {% if block_settings.enabled_by_default %}checked{% endif %}
      >
      <span class="customizations-toggle-b2b__toggle-slider"></span>
    </label>
  </div>

  <div class="customizations-toggle-b2b__content" id="customizations-content-{{ section.id }}">
    <div class="customizations-toggle-b2b__accordions">
      {%- comment -%} Straps & Sleeves Section {%- endcomment -%}
      {% if block_settings.show_straps_sleeves %}
        {%- assign straps_options = block_settings.straps_sleeves_options | newline_to_br | split: '<br />' -%}
        <accordion-custom class="customizations-toggle-b2b__accordion-item">
          <details class="customizations-toggle-b2b__details">
            <summary class="customizations-toggle-b2b__summary">
              <span class="customizations-toggle-b2b__summary-text">
                {{ block_settings.straps_sleeves_label | default: 'Straps & Sleeves' }}
              </span>
              <span class="svg-wrapper icon-caret icon-animated">
                {{- 'icon-caret.svg' | inline_asset_content -}}
              </span>
            </summary>
            <div class="customizations-toggle-b2b__options">
              <div class="customizations-toggle-b2b__options-header">
                <span class="customizations-toggle-b2b__options-count">{{ straps_options.size }} options</span>
                <button
                  type="button"
                  class="customizations-toggle-b2b__clear-all"
                  data-clear-group="straps-sleeves-{{ section.id }}"
                >
                  Clear All
                </button>
              </div>
              {%- for option_line in straps_options -%}
                {%- if option_line != blank -%}
                  {%- assign option_name = option_line | strip -%}
                  {%- if option_name != blank -%}
                    <label class="customizations-toggle-b2b__option-checkbox">
                      <input
                        type="checkbox"
                        name="properties[{{ block_settings.straps_sleeves_label | default: 'Straps & Sleeves' }}]"
                        value="{{ option_name | escape }}"
                        form="{{ product_form_id }}"
                        class="customizations-toggle-b2b__checkbox"
                        data-group="straps-sleeves-{{ section.id }}"
                      >
                      <span class="customizations-toggle-b2b__checkbox-label">{{ option_name | escape }}</span>
                    </label>
                  {%- endif -%}
                {%- endif -%}
              {%- endfor -%}
            </div>
          </details>
        </accordion-custom>
      {% endif %}

      {%- comment -%} Additional customizations sections can be added here {%- endcomment -%}
    </div>

    {% if block_settings.show_additional_link %}
      <a href="#additional-customizations" class="customizations-toggle-b2b__additional-link">
        <span class="svg-wrapper">
          <svg aria-hidden="true" focusable="false" viewBox="0 0 20 20" fill="none">
            <path d="M10 4v12M4 10h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </span>
        {{ block_settings.additional_link_text | default: 'View Additional Customizations' }}
      </a>
    {% endif %}
  </div>
</div>

<script>
  (function() {
    const toggle = document.getElementById('customizations-toggle-{{ section.id }}');
    const content = document.getElementById('customizations-content-{{ section.id }}');
    
    if (toggle && content) {
      function updateContentVisibility() {
        if (toggle.checked) {
          content.style.display = 'block';
          content.setAttribute('aria-hidden', 'false');
        } else {
          content.style.display = 'none';
          content.setAttribute('aria-hidden', 'true');
        }
      }
      
      toggle.addEventListener('change', updateContentVisibility);
      updateContentVisibility(); // Set initial state
    }

    // Clear All functionality
    document.querySelectorAll('[data-clear-group]').forEach(button => {
      button.addEventListener('click', function() {
        const group = this.dataset.clearGroup;
        document.querySelectorAll(`[data-group="${group}"]`).forEach(checkbox => {
          checkbox.checked = false;
        });
      });
    });
  })();
</script>

{% stylesheet %}
  .customizations-toggle-b2b {
    width: 100%;
  }

  .customizations-toggle-b2b__header {
    margin-block-end: var(--padding-md);
  }

  .customizations-toggle-b2b__toggle-wrapper {
    display: flex;
    align-items: center;
    justify-content: space-between;
    cursor: pointer;
  }

  .customizations-toggle-b2b__title {
    font-size: var(--font-size--md);
    font-weight: var(--font-body--weight);
    color: var(--color-foreground);
  }

  .customizations-toggle-b2b__toggle {
    position: absolute;
    opacity: 0;
    width: 0;
    height: 0;
  }

  .customizations-toggle-b2b__toggle-slider {
    position: relative;
    display: inline-block;
    width: 44px;
    height: 24px;
    background-color: var(--color-border);
    border-radius: 24px;
    transition: background-color var(--animation-speed) var(--animation-easing);
  }

  .customizations-toggle-b2b__toggle-slider::before {
    content: '';
    position: absolute;
    width: 18px;
    height: 18px;
    left: 3px;
    top: 3px;
    background-color: var(--color-background);
    border-radius: 50%;
    transition: transform var(--animation-speed) var(--animation-easing);
  }

  .customizations-toggle-b2b__toggle:checked + .customizations-toggle-b2b__toggle-slider {
    background-color: var(--color-primary);
  }

  .customizations-toggle-b2b__toggle:checked + .customizations-toggle-b2b__toggle-slider::before {
    transform: translateX(20px);
  }

  .customizations-toggle-b2b__content {
    margin-block-start: var(--padding-md);
  }

  .customizations-toggle-b2b__accordions {
    display: flex;
    flex-direction: column;
    gap: var(--padding-xs);
  }

  .customizations-toggle-b2b__accordion-item {
    width: 100%;
  }

  .customizations-toggle-b2b__details {
    border: var(--style-border-width) solid var(--color-border);
    border-radius: var(--style-border-radius-inputs);
    overflow: clip;
  }

  .customizations-toggle-b2b__summary {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: var(--padding-md) var(--padding-lg);
    cursor: pointer;
    list-style: none;
    background-color: var(--color-background);
    transition: background-color var(--animation-speed) var(--animation-easing);
  }

  .customizations-toggle-b2b__summary:hover {
    background-color: rgb(var(--color-foreground-rgb) / var(--opacity-5));
  }

  .customizations-toggle-b2b__summary::-webkit-details-marker {
    display: none;
  }

  .customizations-toggle-b2b__summary-text {
    font-size: var(--font-size--sm);
    font-weight: var(--font-body--weight);
    color: var(--color-foreground);
  }

  .customizations-toggle-b2b__summary .icon-caret {
    width: var(--icon-size-xs);
    height: var(--icon-size-xs);
    color: var(--color-foreground);
    transition: transform var(--animation-speed) var(--animation-easing);
  }

  .customizations-toggle-b2b__details[open] .customizations-toggle-b2b__summary .icon-caret {
    transform: rotate(90deg);
  }

  .customizations-toggle-b2b__options {
    padding: var(--padding-md);
    background-color: var(--color-background);
  }

  .customizations-toggle-b2b__options-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-block-end: var(--padding-sm);
  }

  .customizations-toggle-b2b__options-count {
    font-size: var(--font-size--xs);
    color: rgb(var(--color-foreground-rgb) / var(--opacity-subdued-text));
  }

  .customizations-toggle-b2b__clear-all {
    background: none;
    border: none;
    color: var(--color-primary);
    font-size: var(--font-size--xs);
    cursor: pointer;
    text-decoration: underline;
    padding: 0;
  }

  .customizations-toggle-b2b__clear-all:hover {
    color: var(--color-primary-hover);
  }

  .customizations-toggle-b2b__option-checkbox {
    display: flex;
    align-items: center;
    gap: var(--padding-xs);
    padding: var(--padding-sm) 0;
    cursor: pointer;
  }

  .customizations-toggle-b2b__checkbox {
    width: 18px;
    height: 18px;
    cursor: pointer;
  }

  .customizations-toggle-b2b__checkbox-label {
    font-size: var(--font-size--sm);
    color: var(--color-foreground);
  }

  .customizations-toggle-b2b__additional-link {
    display: inline-flex;
    align-items: center;
    gap: var(--padding-xs);
    margin-block-start: var(--padding-md);
    color: var(--color-primary);
    font-size: var(--font-size--sm);
    text-decoration: none;
  }

  .customizations-toggle-b2b__additional-link:hover {
    color: var(--color-primary-hover);
    text-decoration: underline;
  }

  .customizations-toggle-b2b__additional-link .svg-wrapper {
    width: var(--icon-size-xs);
    height: var(--icon-size-xs);
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Customizations Toggle",
  "tag": null,
  "settings": [
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Customizations"
    },
    {
      "type": "checkbox",
      "id": "enabled_by_default",
      "label": "Enabled by Default",
      "default": false
    },
    {
      "type": "header",
      "content": "Straps & Sleeves"
    },
    {
      "type": "checkbox",
      "id": "show_straps_sleeves",
      "label": "Show Straps & Sleeves",
      "default": true
    },
    {
      "type": "text",
      "id": "straps_sleeves_label",
      "label": "Straps & Sleeves Label",
      "default": "Straps & Sleeves",
      "visible_if": "{{ block.settings.show_straps_sleeves }}"
    },
    {
      "type": "textarea",
      "id": "straps_sleeves_options",
      "label": "Straps & Sleeves Options",
      "info": "Enter one option per line",
      "default": "Tulip Sleeves (Plain)\nTank Top Straps (Plain)\nTank Top Straps (BE/BLA)",
      "visible_if": "{{ block.settings.show_straps_sleeves }}"
    },
    {
      "type": "header",
      "content": "Additional Link"
    },
    {
      "type": "checkbox",
      "id": "show_additional_link",
      "label": "Show Additional Customizations Link",
      "default": true
    },
    {
      "type": "text",
      "id": "additional_link_text",
      "label": "Additional Link Text",
      "default": "View Additional Customizations",
      "visible_if": "{{ block.settings.show_additional_link }}"
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding-block-start",
      "label": "Top",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-block-end",
      "label": "Bottom",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-start",
      "label": "Left",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding-inline-end",
      "label": "Right",
      "min": 0,
      "max": 100,
      "step": 1,
      "unit": "px",
      "default": 0
    }
  ],
  "presets": [
    {
      "name": "Customizations Toggle",
      "category": "Product"
    }
  ]
}
{% endschema %}
